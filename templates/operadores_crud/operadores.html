{% extends "admin_panel/navbar_admin.html" %}
{% load static %}

{% block title %}Panel AdministradorREDIMIR{% endblock %}

{# ➊ CSS extra específico de este panel #}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/operadores.css' %}">
<script src="{% static 'js/operadores.js' %}"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
{% endblock %}

{% block main %}
<h1 class="mb-4 text-dark">Gestion Operadores</h1>

<!-- =====  tarjetas resumen  ===== -->
<div class="row">
  <div class="col-md-6">
    <div class="card text-white bg-primary">
      <div class="card-body">
        <h5 class="card-title">Cantidad total de Operadores</h5>
        <p class="card-text">{{ total_operadores }}</p>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card text-white bg-success">
      <div class="card-body">
        <h5 class="card-title">Operador con mas Registros</h5>
        <p class="card-text">{{ operador_top_registros.idOperador__nombre }}</p>
      </div>
    </div>
  </div>
</div>
<div class="card mt-4">
  <div class="card-body">
    <h5 class="card-title">Generar Operador</h5>
    <div class="d-flex btn-group-row">
      <div class="col-md-4 text-center mb-3 mb-md-0">
          <img src="{% static 'img/operador.png' %}" alt="Imagen" class="img-fluid rounded"/>
        </div>
        <div class="col-md-8 mt-4">
          <form method="post">
            {% csrf_token %}
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Nombre</label>
                <input type="text" class="form-control" name="nombre" maxlength="30" required/>
              </div>
              <div class="col-md-6">
                <label class="form-label">Rut</label>
                <input type="text" class="form-control" name="rut" maxlength="10"  placeholder="12345678-9" required/>
              </div>
              <div class="col-md-12">
                <label class="form-label">Correo Electronico</label>
                <input type="email" class="form-control" name="email"required/>
              </div>
              <div class="col-md-12">
                <label class="form-label">Contraseña</label>
                <input type="password" class="form-control" name="contraseña" maxlength="30" required/>
              </div>
              {% if messages %}
              {% for msg in messages %}
              <div class="alert alert-{{ msg.tags }} text-center" role="alert">
                {{ msg }}
            </div>
            {% endfor %}
            {% endif %}
              <div class="col-12 text-end">
                <button type="submit" name="submit_operador" class="btn btn-success mt- btn-opcion">Registrar</button>
              </div>
            </div>
          </form>
        </div>
    </div>
  </div>
</div>
<div class="card mt-4">
  <div class="card-body">
    <h5 class="card-title">Lista de Operadores</h5>
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Rut</th>
            <th>Email</th>
            <th>Estado</th>
            <th>Eliminar</th>
            <th>Ver Perfil</th>
          </tr>
        </thead>
        <tbody>
            {% for op in operadores_info %}
            <tr id="fila-{{ op.id }}">
                <td>{{ op.nombre }}</td>
                <td>{{ op.rut }}</td>
                <td>{{ op.email }}</td>
                <td><button 
                  id="btn-estado-{{ op.id }}" 
                  class="btn {% if op.estado %}btn-success{% else %}btn-danger{% endif %}" 
                  onclick="cambiarEstado('{{ op.id }}')">
                  {% if op.estado %}Activo{% else %}Bloqueado{% endif %}
                </button></td>
      <td>
        <a  href="{% url 'operador_eliminar' op.id %}" class="btn btn-danger" onclick="return confirm('¿Seguro que quieres eliminar a {op.nombre}?');"><i class="bi bi-trash" style="font-size: 1.1rem;"></i></a>
      </td>
      <td>
        <a href="{% url 'operador_perfil' op.id %}" class="btn btn-dark">Ver</a>
      </td>
    </tr>
  {% empty %}
    <tr><td colspan="7" class="text-center">Sin operadores aún.</td></tr>
  {% endfor %}
</tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
